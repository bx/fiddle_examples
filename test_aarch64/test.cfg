[Main]
root = '~/fiddle/fiddle_examples/test_aarch64'
name = "_test"
cc = "/usr/bin/aarch64-linux-gnu-"
hardwareclass = '_hw'
test_data_path="{Main.root}/test_results"

[HardwareClass._hw]
	hw_info_path = "{Main.hw_info_path}/{HardwareClass._hw.name}"
  	hosts = ['qemu']
	default_host = 'qemu'	
	addr_range = [0x00000000, 0xffffffffffffffff]	
[HostConfig]
  [HostConfig.qemu]
	tracing_methods = ['calltrace']
  [HostConfig.qemu.GDBConfig]
   calltrace_no_recursion = ""
   calltrace_blacklist__single = ""

[Target]
software = "_test"

[Software._test]
root = "{Main.root}/test_src"
build_prepare = ""

[Software._test.Files.target]
relative_path="_test"
type = "image"

[Software.gdb]
root = '/usr/bin/aarch64-none-elf-'
build = false		
binary = '{Software.gdb.root}gdb'

[Software.gdb_tools]
build = false	
root = '{Main.test_suite_dir}/fiddle_gdb'
binary = '{Software.gdb_tools.root}/gdb_tools.py'

[Software.gdb_tools.GDBConfig]
	commands = ["python execfile(\"{Software.gdb_tools.binary}\")",
		 "gdb_tools dir {runtime.python_path}",
		 "gdb_tools update_path",
		 "file {target.file.elf.{runtime.stage}}",
	]


[TraceMethod]
  run = "I_CONF={config} {Software.gdb.binary} -ex 'set environment I_CONF={config}' {TraceMethod.gdb_commands} -ex 'gdb_tools go -p' -ex 'c' -ex 'q' && true"
	       
    [TraceMethod.calltrace]
      software = ["gdb", "qemu", "gdb_tools", "calltrace"]
      [TraceMethod.calltrace.Files.org]
        type = "target"
        relative_path = "calltrace.org"              
      [TraceMethod.calltrace.GDBConfig]
        commands = ["gdb_tools plugin {Software.calltrace.binary}",
		    "calltrace test_instance {runtime.instance_id}",
		    "calltrace test_trace {runtime.trace.id}",
		    'calltrace stage_log {runtime.stage} {TraceMethod.calltrace.Files.org.{runtime.stage}}',
		    'calltrace sourceinfo']


  [Software.qemu]
    root = '/usr/bin'
    type = 'host'
    binary = '{Software.qemu.root}/qemu-aarch64'
    build = false
    [Software.qemu.ExecConfig]
      command = "-g 4444 -singlestep {target.file.elf._single} &"
    [Software.qemu.GDBConfig]
      commands = ["set tcp connect-timeout 120",
	          "set remotetimeout -1",
		  "file {target.file.elf.{runtime.stage}}",			    
		  "shell {Software.qemu.ExecConfig.command}",			    
	 	  "target extended-remote localhost:4444"]
